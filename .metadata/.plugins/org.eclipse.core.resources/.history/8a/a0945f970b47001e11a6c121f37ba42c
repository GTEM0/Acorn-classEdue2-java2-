<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@  page import="java.sql.*"%>

<%
String r_num = request.getParameter("r_num");
String m_code="";
String id = "";
String name = "";
String phone = "";
String m_name = "";
String genre = "";
String runtime= "";
String start_end = "";
String price = "";
String cnt = "";
String total_price = "";
%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="./css/reserve.css" rel="stylesheet" />
<script>
	function check() {
		/*
		 let taxi_form = document.taxi_form;
		 let regno = taxi_form.regno;
		 let regtime = taxi_form.regtime;
		 let regdate = taxi_form.regdate;
		 let cusno = taxi_form.cusno;
		 let startpoint = taxi_form.startpoint;
		 let destination = taxi_form.destination;
		 let taxino = taxi_form.taxino;
		 let state = taxi_form.state;

		 if (regno.value == "") {
		 alert("예약번호를 입력하세요!");
		 regno.focus();
		 return false;
		 } else if (regtime.value == "") {
		 alert("예약시간을 입력하세요!");
		 regtime.focus;
		 return false;
		 } else if (regdate.value == "") {
		 alert("예약날짜를 입력하세요!");
		 regdate.focus;
		 return false;
		 } else if (cusno.value == "") {
		 alert("아이디를 입력하세요!");
		 cusno.focus;
		 return false;
		 } else if (startpoint.value == "") {
		 alert("시작지점을 입력하세요!");
		 startpoint.focus;
		 return false;
		 } else if (destination.value == "") {
		 alert("도착지점을 입력하세요!");
		 destination.focus;
		 return false;
		 } else if (taxino.value == "") {
		 alert("택시번호를 입력하세요!");
		 taxino.focus;
		 return false;
		 } else if (state.value == "선택하기") {
		 alert("배차상태를 선택하세요!");
		 state.focus;
		 return false;
		 }
		
		 */
		return true;
	}
</script>
</head>
<body>
<%
	String userpw = "";
	String username = "";

	Connection con = null;
	Statement st = null;
	ResultSet rs = null;
	try {
		String driver = "oracle.jdbc.driver.OracleDriver";
		String url = "jdbc:oracle:thin:@localhost:1521:xe";
		String user = "scott";
		String password = "tiger";

		//1. 오라클드라이버 로딩
		Class.forName(driver); //2. 데이터베이스 연결
		con = DriverManager.getConnection(url, user, password); //3. statement 얻어오기

		String sql = " select o.R_NUM, m.m_code, c.ID 회원아이디,c.NAME 회원이름,SUBSTR(c.phone,1,9)||'****' 연락처,";
		sql += " m.M_TITLE 영화제목,m.M_GENRE 장르,m.M_RUNTIME||'분' 런타임,m.M_START_END 상영시간,";
		sql += " m.M_PRICE ||'원' 티켓가격, o.O_CNT ||'매' 예매수량,	(m.M_PRICE * o.O_CNT) ||'원'총금액";
		sql += " from tbl_customer_02 c	inner join tbl_movie_order_02 o	on c.ID = o.O_ID";
		sql += " inner join tbl_movie02 m on o.O_CODE = m.M_CODE where r_num = '" + r_num + "'";;

		st = con.createStatement();		
		rs = st.executeQuery(sql);

		if (rs.next()) {
			
			m_code = rs.getString(2);
			id = rs.getString(3);
			name = rs.getString(4);
			phone = rs.getString(5);
			m_name = rs.getString(6);
			genre = rs.getString(7);
			runtime = rs.getString(8);
			start_end = rs.getString(9);
			price = rs.getString(10);
			cnt = rs.getString(11);
			total_price = rs.getString(12);
			
		}

	} catch (Exception e) {
		e.printStackTrace();
	} finally { //자원의 반납
		if (rs != null)
			rs.close();
		if (st != null)
			st.close();
		if (con != null)
			con.close();
	}
	%>

	<form name="frm" action="update_action.jsp" method="post"
		onsubmit="return check()">
		<table>
			<caption>
				<strong>영화 예약 변경</strong>
			</caption>
			<tr>
				<td>예약번호</td>
				<td><input type="text"  name="r_num"></td>
			</tr>
			<tr>
				<td>영화코드</td>
				<td><input type="text"  name="m_code"></td>
			</tr>
			<tr>
				<td>회원아이디</td>
				<td><input type="text" name="id"></td>
			</tr>
			<tr>
				<td>회원이름</td>
				<td><input type="text" name="name"></td>
			</tr>
			<tr>
				<td>연락처</td>
				<td><input type="text" name="phone"></td>
			</tr>
			<tr>
				<td>장르</td>
				<td><input type="text" name="genre"></td>
			</tr>
			<tr>
				<td>영화제목</td>
				<td><input type="text" name="m_name"></td>
			</tr>
			<tr>
				<td>런타임</td>
				<td><input type="text" name="runtime"></td>
			</tr>
			<tr>
				<td>상영시간</td>
				<td><input type="text" name="start_end"></td>
			</tr>
			<tr>
				<td>티켓가격</td>
				<td><input type="text" name="price"></td>
			</tr>
			<tr>
				<td>예매수량</td>
				<td><input type="text" name="cnt"></td>
			</tr>
			<tr>
				<td>총금액</td>
				<td><input type="text" name="total_price"></td>
			</tr>
			<tr>
				<td colspan="2">
					<button>변경</button>
					<button>다시입력</button>
				</td>



			</tr>
		</table>
	</form>

	<script type="text/javascript">
	
let frm = document.frm;

frm.r_num.value="<%=r_num%>";
frm.m_code.value="<%=m_code%>";
frm.id.value="<%=id%>";
frm.name.value="<%=name%>";
frm.phone.value="<%=phone%>";
frm.m_name.value="<%=m_name%>";
frm.genre.value="<%=genre%>";
frm.start_end.value="<%=start_end%>";
frm.runtime.value="<%=runtime%>";
frm.price.value="<%=price%>";
frm.cnt.value="<%=cnt%>";
frm.total_price.value="<%=total_price%>";


	</script>
</body>
</html>